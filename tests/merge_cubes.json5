{
  "id": "merge_cubes",
  "level": "L3",
  "tests": [
    {
      "arguments": {
        "cube1": {
          "$ref": "assets/xyb-minimal-int.json5"
        },
        "cube2": {
          "$ref": "assets/xyb-mask-one-band.json5"
        }
      },
      "returns": {
        "type": "datacube",
        "nodata": 255,
        "order": ["bands", "y", "x"],
        "dimensions": {
          "bands": {
            "type": "bands",
            "values": ["red", "green", "blue", "mask"]
          },
          "y": {
            "type": "spatial",
            "axis": "y",
            "values": [5757495.0, 5757485.0, 5757475.0],
            "reference_system": "EPSG:25832"
          },
          "x": {
            "type": "spatial",
            "axis": "x",
            "values": [404835.0, 404845.0, 404855.0, 404865.0],
            "reference_system": "EPSG:25832"
          }
        },
        "data": [
          [
            [172, 47, 117, 192],
            [67, 251, 195, 103],
            [9, 211, 255, 242]
          ],
          [
            [36, 87, 70, 216],
            [88, 140, 58, 193],
            [230, 39, 255, 87]
          ],
          [
            [174, 88, 81, 255],
            [25, 77, 72, 9],
            [148, 115, 255, 208]
          ],
          [
            [1, 1, 1, 1],
            [1, 0, 0, 1],
            [0, 0, 1, 0]
          ]
        ]
      }
    },
    {
      "arguments": {
        "cube1": {
          "$ref": "assets/xyb-minimal-int.json5"
        },
        "cube2": {
          "$ref": "assets/xyb-mask-one-band.json5"
        }
      },
      "returns": {
        "type": "datacube",
        "nodata": 255,
        "order": ["bands", "y", "x"],
        "dimensions": {
          "bands": {
            "type": "bands",
            "values": ["red", "green", "blue", "mask"]
          },
          "y": {
            "type": "spatial",
            "axis": "y",
            "values": [5757495.0, 5757485.0, 5757475.0],
            "reference_system": "EPSG:25832"
          },
          "x": {
            "type": "spatial",
            "axis": "x",
            "values": [404835.0, 404845.0, 404855.0, 404865.0],
            "reference_system": "EPSG:25832"
          }
        },
        "data": [
          [
            [172, 47, 117, 192],
            [67, 251, 195, 103],
            [9, 211, 255, 242]
          ],
          [
            [36, 87, 70, 216],
            [88, 140, 58, 193],
            [230, 39, 255, 87]
          ],
          [
            [174, 88, 81, 255],
            [25, 77, 72, 9],
            [148, 115, 255, 208]
          ],
          [
            [1, 1, 1, 1],
            [1, 0, 0, 1],
            [0, 0, 1, 0]
          ]
        ]
      }
    },
    {
      "arguments": {
        "cube1": {
          "$ref": "assets/xyt-minimal-float.json5"
        },
        "cube2": {
          "$ref": "assets/xyt-more-timestamps.json5"
        }
      },
      "throws": "OverlapResolverMissing"
    },
    {
      "arguments": {
        "cube1": {
          "$ref": "assets/xyt-minimal-float.json5"
        },
        "cube2": {
          "$ref": "assets/xyt-more-timestamps.json5"
        },
        "overlap_resolver": {
          "process_graph": {
            "sum": {
              "process_id": "sum",
              "arguments": {
                "data": [
                  {
                    "from_argument": "x"
                  },
                  {
                    "from_argument": "y"
                  }
                ]
              },
              "result": true
            }
          }
        }
      },
      "returns": {
        "type": "datacube",
        "nodata": NaN,
        "order": ["t", "y", "x"],
        "dimensions": {
          "t": {
            "type": "temporal",
            "values": [
              "2020-06-01T00:00:00Z",
              "2020-06-03T00:00:00Z",
              "2020-06-05T00:00:00Z",
              "2020-06-07T00:00:00Z",
              "2020-06-09T00:00:00Z"
            ]
          },
          "y": {
            "type": "spatial",
            "axis": "y",
            "values": [5757495.0, 5757485.0, 5757475.0],
            "reference_system": "EPSG:25832"
          },
          "x": {
            "type": "spatial",
            "axis": "x",
            "values": [404835.0, 404845.0, 404855.0, 404865.0],
            "reference_system": "EPSG:25832"
          }
        },
        "data": [
          [
            [35.0, 107.5, -54.2, -128.5],
            [-36.0, 16.9, -6.22, -41.0],
            [100.8, 98.48, 50.32, -163.2]
          ],
          [
            [-127.3, 18.0, -137.04, -16.0],
            [2.1, -127.6, 146.1, 102.1],
            [95.72, -42.6, NaN, 92.3]
          ],
          [
            [-13.40, 36.07, 43.88, 74.72],
            [79.92, 74.10, 98.28, -23.62],
            [-70.40, -30.03, 1.26, 5.28]
          ],
          [
            [71.79, NaN, 97.01, -76.48],
            [-21.55, NaN, -60.00, 56.84],
            [-11.94, -54.23, NaN, 73.26]
          ],
          [
            [-12.23, 61.46, 2.38, -84.76],
            [ 28.36, 48.45, -65.85, 65.90],
            [ 29.50, -45.82, 78.05, 58.27]
          ]
        ]
      }
    }
  ]
}
